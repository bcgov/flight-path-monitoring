---
title: "Flight path monitoring"
author: "Boostao"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
if (!requireNamespace("remotes")) install.packages("remotes")
remotes::install_github("dkahle/ggmap")
remotes::install_github("r-spatial/sf")
remotes::install_github("bcgov/bcdata")
library(sf)
library(ggmap)
library(bcdata)
```

## Flight path monitoring analysis

This document will explain the data manipulation required to conduct flight path analysis of time spent in wild life habitat areas.

The data required for this analysis are:
 - Legal habitat areas
 - Digital elevation model
 - Flightline data
 
## Retrieve and visualize habitat areas
```{r habitat_areas, eval=FALSE, include=TRUE}

# Skeena - Mountaingoat winter habitat 
tmpdir <- file.path(tempdir(),"zipped")
unzip("./Habitat/Skeena-mountaingoatwinterhab.shp.ALGORAB.20784.25740.sr.zip", exdir = tmpdir)
Skeena_mountaingoatwinterhab <- st_read(tmpdir)
unlink(tmpdir, recursive = TRUE)

# Ungulate Winter Range- Approved
# bcdc_search("Ungulate Winter Range")
Ungulate_winterrange_approved <- bcdc_get_data(bcdc_get_record("712bd887-7763-4ed3-be46-cdaca5640cc1"))
Ungulate_winterrange_approved <- Ungulate_winterrange_approved[
  which(Ungulate_winterrange_approved$SPECIES_1 %in% c("M-ORAM", "M-RATA-01", "M-RATA-15")),
]

# Ungulate Winter Range- Proposed
# bcdc_search("Ungulate Winter Range")
Ungulate_winterrange_proposed <- bcdc_get_data(bcdc_get_record("e5c2a2e3-70fc-49e3-9840-87212853e8a2"))
Ungulate_winterrange_proposed <- Ungulate_winterrange_proposed[
  which(Ungulate_winterrange_proposed$SPECIES_1 %in% c("M-ORAM", "M-RATA-01", "M-RATA-15")),
]

# Strategic Land and Resource Plans - All
# Have to be downloaded manually from iMapBC after selecting appropriate layers.
# Caribou is in the RMP_PLAN_LEGAL_POLY_SVW layer, all others are in the RMP_PLAN_NON_LEGAL_POLY_SVW
# layer
tmpdir <- file.path(tempdir(),"zipped")
unzip("./Habitat/RMP_PLAN_LEGAL_POLY_SVW.zip", exdir = tmpdir)
legal_habitat_areas <- st_read(file.path(tmpdir, "RMP_PLAN_LEGAL_POLY_SVW"))
legal_habitat_areas <- legal_habitat_areas[
  which(
    legal_habitat_areas$SLRP_NAME == "Dease-Liard Sustainable Resource Management Plan" &
    legal_habitat_areas$FEAT_OBJ %in% c("Caribou Winter Habitat Zones")
  ),
]
unlink(tmpdir, recursive = TRUE)

tmpdir <- file.path(tempdir(),"zipped")
unzip("./Habitat/RMP_PLAN_NON_LEGAL_POLY_SVW.zip", exdir = tmpdir)
non_legal_habitat_areas <- st_read(file.path(tmpdir, "RMP_PLAN_NON_LEGAL_POLY_SVW"))
unlink(tmpdir, recursive = TRUE)

non_legal_habitat_areas <- non_legal_habitat_areas[
  which(
    (
      non_legal_habitat_areas$SLRP_NAME == "Dease-Liard Sustainable Resource Management Plan" &
      non_legal_habitat_areas$FEAT_OBJ == "High Value Mountain Ungulate Habitat"  
    ) |
    (
      non_legal_habitat_areas$SLRP_NAME == "Lakes District Land and Resource Management Plan" &
      non_legal_habitat_areas$FEAT_OBJ == "SRMZ3:Caribou Migration Corridor Sub-Zone" &
      non_legal_habitat_areas$ATRB2_VAL %in% c("Caribou Migration Corridor - High", "Caribou Migration Corridor - Very High")
    ) |
    (
      non_legal_habitat_areas$SLRP_NAME == "Morice Land and Resource Management Plan" &
      non_legal_habitat_areas$FEAT_OBJ %in% c("Mountain Goat Habitat Areas", "Takla Caribou Winter Range", "Tweedsmuir Caribou:Calving Islands")
    )
  ),
]

```

